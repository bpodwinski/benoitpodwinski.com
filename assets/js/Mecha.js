var Mecha=function(){var s,n,i,e=[],r=10,h=[],c=[],l=new THREE.Vector3,u=new THREE.Vector3,d=!1;function t(e){if(1===e.touches.length){var n=new THREE.Vector2;n.x=e.touches[0].pageX/window.innerWidth*2-1,n.y=-e.touches[0].pageY/window.innerHeight*2+1,a(n)}}function o(e){var n=new THREE.Vector2;n.x=e.clientX/window.innerWidth*2-1,n.y=-e.clientY/window.innerHeight*2+1,a(n)}function a(e){var n=new THREE.Raycaster;n.setFromCamera(e,VizHandler.getCamera());var t=n.intersectObject(cubeMesh,!0);if(t[0]){d=!0;var o=t[0].point.multiplyScalar(20);TweenMax.to(l,.1*l.distanceTo(o),{x:.6*o.x,z:.6*o.z,ease:Linear.easeNone,onComplete:function(){d=!1}})}}function E(e){for(var n=new THREE.CylinderGeometry(0,3,e.height,7,3*e.segmentCount,!0),t=0;t<n.vertices.length;t++){var o=n.vertices[t],a=o.y+e.halfHeight,i=Math.floor(a/e.segmentHeight),s=a%e.segmentHeight/e.segmentHeight;o.x-=2*(.5-Math.random()),o.z-=2*(.5-Math.random()),o.y==-e.segmentHeight&&(o.x=o.z=0),n.skinIndices.push(new THREE.Vector4(i,i+1,0,0)),n.skinWeights.push(new THREE.Vector4(1-s,s,0,0))}return n}function w(e){bones=[];var n=new THREE.Bone;bones.push(n),n.position.y=-e.halfHeight;for(var t=0;t<e.segmentCount;t++){var o=new THREE.Bone;o.position.y=e.segmentHeight,bones.push(o),n.add(o),n=o}return bones}function H(e,n){var t=new THREE.SkinnedMesh(e,i),o=new THREE.Skeleton(n);t.castShadow=!0,t.frustumCulled=!1,t.add(n[0]),t.bind(o);var a=new THREE.SkeletonHelper(t);return a.material.linewidth=2,skeletonHelpers.push(a),t}function M(){var e=1e-4*Date.now();if(!d){var n=new THREE.Vector3(window.innerWidth/window.innerHeight*10*Math.sin(0+2*e)*Math.sin(0+3.5*e)*1,0,15*Math.sin(0+1*e)*Math.sin(0+4.5*e)*1);TweenMax.to(l,.2*l.distanceTo(n),{x:n.x,z:n.z,ease:Linear.easeNone})}TweenMax.to(l,0,{y:2*Math.sin(0+10*e),ease:Linear.easeNone}),TweenMax.to(u,1,{x:l.x,y:l.y,z:l.z,ease:Linear.easeNone});for(var t=0;t<r;t++){var o=meshes[t];if(0==h[t].x||Math.random()<.003||13<h[t].distanceTo(l)&&!TweenMax.isTweening(c[t])){var a=2*Math.PI*(t/r+Math.random()/10);h[t].x=l.x+10*Math.sin(a),h[t].y=0,h[t].z=l.z+10*Math.cos(a),h[t].oldCenter.copy(l),TweenMax.killTweensOf(c[t]),TweenMax.to(c[t],.4,{x:h[t].x,z:h[t].z}),TweenMax.to(c[t],.2,{y:5}),TweenMax.to(c[t],.2,{delay:.2,y:h[t].y})}o.skeleton.bones[0].position.copy(u),o.skeleton.bones[0].position.add(u.clone().multiplyScalar(.5)),o.skeleton.bones[1].position.set(c[t].x/2,5+c[t].y/2,c[t].z/2),o.skeleton.bones[1].position.sub(u.clone().multiplyScalar(.5)),o.skeleton.bones[2].position.set(c[t].x,-10+c[t].y,c[t].z),o.skeleton.bones[2].position.sub(u.clone().multiplyScalar(1)),skeletonHelpers[t].update()}}function g(){}return{init:function(){events.on("update",M),events.on("onBeat",g),s=new THREE.Object3D,VizHandler.getScene().add(s),function(){n&&(s.remove(n),n.geometry.dispose(),n=null);THREE.SmoothShading;var e=Assets.getCubeMap(31);e.format=THREE.RGBFormat;new THREE.Color(1,1,1);i=new THREE.MeshStandardMaterial({skinning:!0,bumpScale:.055,color:16777215,metalness:1,roughness:0,shading:THREE.FlatShading,envMap:e,side:THREE.DoubleSide}),function(){meshes=[],skeletonHelpers=[];for(var e={segmentHeight:5,segmentCount:2,height:10,halfHeight:5},n=0;n<r;n++){var t,o=E(e),a=w(e);(t=H(o,a)).scale.set(.05,.05,.05),s.add(t),meshes.push(t);var i=new THREE.Vector3;i.oldCenter=new THREE.Vector3,h.push(i),c.push(i.clone())}}()}(),cubeMaterial=new THREE.MeshPhongMaterial({shading:THREE.FlatShading,emissive:3355443}),cubeMesh=new THREE.Mesh(new THREE.PlaneGeometry(100,100),cubeMaterial),cubeMesh.rotation.x=-Math.PI/2,cubeMesh.position.y=-.25,cubeMesh.receiveShadow=!0,s.add(cubeMesh),document.addEventListener("mousemove",o),document.addEventListener("touchmove",t,!1)},update:M,onBeat:g,prerender:function(){},postrender:function(){},setEnvMap:function(e){i.envMap=e},getRandomOne:function(){return e[Math.floor(Math.random()*e.length)]}}}();
//# sourceMappingURL=Mecha.js.map
